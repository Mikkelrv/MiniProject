@page "/myprofile"
@inject NavigationManager navManager
@inject ILoginService loginService

<h3>User Profile</h3>

@if (user == null)
{
    <p>Loading profile...</p>
}
else
{
    <div>
        <p><strong>Name:</strong> @user.Name</p>
        <p><strong>Email:</strong> @user.Email</p>

        <h4 style="padding-top: 5px;">Purchased Items</h4>
        @if (user.Purchases.Any())
        {
            <table class="table" style="table-layout: fixed; width: 100%;">
                <thead>
                    <tr>
                        <th>Image</th>
                        <th>Item Name</th>
                        <th>Price</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in user.Purchases)
                    {
                        <tr @onclick="() => OpenItemDetailModal(item)">
                            <td>
                                <img src="@item.ImageUrl" alt="@item.Name" width="100" height="100" />
                            </td>
                            <td>@item.Name</td>
                            <td>@item.Price</td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <p>No purchases to display.</p>
        }

        <h4>Selling Items</h4>
        @if (user.Selling.Any())
        {
            <table class="table" style="table-layout: fixed; width: 100%;">
                <thead>
                    <tr>
                        <th>Image</th>
                        <th>Item Name</th>
                        <th>Price</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in user.Selling)
                    {
                        <tr @onclick="() => OpenItemDetailModal(item)">
                            <td>
                                <img src="@item.ImageUrl" alt="@item.Name" width="100" height="100" />
                            </td>
                            <td>@item.Name</td>
                            <td>@item.Price</td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <p>No items listed for sale.</p>
        }
    </div>

    @if (isModalOpen)
    {
        <ItemDetailModal Item="selectedItem" OnClose="CloseModal" />
    }
}

@code {
    private User? user;
    private bool showImages = true; // Images should be shown in the table
    private bool isModalOpen = false; // Flag to show/hide modal
    private Item? selectedItem; // The selected item for modal

    protected override async Task OnInitializedAsync()
    {
        user = await loginService.GetUserLoggedIn();
        if (user == null)
            navManager.NavigateTo("login");
    }

    // Method to open the item detail modal
    private void OpenItemDetailModal(Item item)
    {
        selectedItem = item;
        isModalOpen = true;
    }

    // Method to close the modal
    private void CloseModal()
    {
        isModalOpen = false;
    }
}
